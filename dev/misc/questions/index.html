<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Meeting Notes · CfGRIB.jl</title><link rel="canonical" href="https://ecmwf.github.io/cfgrib.jl/stable/misc/questions/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">CfGRIB.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../man/guide/">Manual</a></li><li><span class="tocitem">Library</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lib/internals/backends/">Backends</a></li><li><a class="tocitem" href="../../lib/internals/cfmessage/">CFMessage</a></li><li><a class="tocitem" href="../../lib/internals/constants/">Constants</a></li><li><a class="tocitem" href="../../lib/internals/dataset/">Dataset</a></li><li><a class="tocitem" href="../../lib/internals/indexing/">Indexing</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Meeting Notes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Meeting Notes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ecmwf/cfgrib.jl/blob/master/docs/src/misc/questions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="cfgrib-questions-1"><a class="docs-heading-anchor" href="#cfgrib-questions-1">cfgrib questions</a><a class="docs-heading-anchor-permalink" href="#cfgrib-questions-1" title="Permalink"></a></h2><p>Some questions I need input on, in no particular order:</p><h3 id="logging-1"><a class="docs-heading-anchor" href="#logging-1">logging</a><a class="docs-heading-anchor-permalink" href="#logging-1" title="Permalink"></a></h3><p>How is the logging functionality usually used? So far I just haven&#39;t implemented it, for when I do it would be useful to know if it&#39;s only (or primarily) used for developing and debugging the package, or if it is actually used to log info for data analysis by users (not developers) of the package.</p><h3 id="offsets-1"><a class="docs-heading-anchor" href="#offsets-1">offsets</a><a class="docs-heading-anchor-permalink" href="#offsets-1" title="Permalink"></a></h3><p>There is a discrepancy between how offsets are defined and used in cfgrib with the GRIB file seek method and in the Julia GRIB package, in Julia seek seeks through the messages themselves not the actual offset values.</p><p>This is probably due to me making a mistake, don&#39;t know enough about GRIB spec to figure out how this should be done.</p><h3 id="filter-by-keys-examples-1"><a class="docs-heading-anchor" href="#filter-by-keys-examples-1">filter by keys examples</a><a class="docs-heading-anchor-permalink" href="#filter-by-keys-examples-1" title="Permalink"></a></h3><p>Would be nice to see some examples of how and when <code>filter_by_keys</code> is used so that I can add in some tests for it.</p><h3 id="use-of-history-1"><a class="docs-heading-anchor" href="#use-of-history-1">use of history</a><a class="docs-heading-anchor-permalink" href="#use-of-history-1" title="Permalink"></a></h3><p>How is the <code>history</code> field used? There are some problems with correctly escaping quotes and making the string look like a dictionary in Julia, so right now it&#39;s not really equivalent to the python version.</p><h3 id="OnDiskArray-dtype-1"><a class="docs-heading-anchor" href="#OnDiskArray-dtype-1">OnDiskArray dtype</a><a class="docs-heading-anchor-permalink" href="#OnDiskArray-dtype-1" title="Permalink"></a></h3><p>The <code>OnDiskArray</code> class in Python has a <code>dtype</code> filed which is always set to <code>Float32</code>, is the multidimensional message data in GRIB always that type, or should I try to infer what type it is from the file and then set the type of the <code>OnDiskArray</code> to match that?</p><h3 id="cfmessage-conversion-methods-1"><a class="docs-heading-anchor" href="#cfmessage-conversion-methods-1">cfmessage conversion methods</a><a class="docs-heading-anchor-permalink" href="#cfmessage-conversion-methods-1" title="Permalink"></a></h3><p>There are a few methods in <code>cfmessage</code> which aren&#39;t called by the tests, so I haven&#39;t added their equivalents in yet for Julia. Could I have some examples for these being called:</p><ul><li><code>to_grib_date_time</code></li><li><code>from_grib_step</code></li><li><code>to_grib_step</code></li><li><code>from_grib_month</code></li></ul><h3 id="intensive-real-life-examples-1"><a class="docs-heading-anchor" href="#intensive-real-life-examples-1">intensive real-life examples</a><a class="docs-heading-anchor-permalink" href="#intensive-real-life-examples-1" title="Permalink"></a></h3><p>There&#39;s quit a bit of optimisation that I could apply to make the package both faster to use on its own, or to make it easier to use it with other tools (e.g. outputting shared or distributed arrays for parallelised tasks; CuArrays for GPU tasks), but I need an example of real analysis code that calls cfgrib for this. It&#39;s hard to optimise the code without seeing real usecases.</p><p>Also I&#39;m at the stage where I need to make some decisions on how users interface with the functions, it&#39;s hard to figure out the right design without seeing how people currently use cfgrib.</p><p>A non-trivial example going through a decent amount of data would also let me create a performance benchmark, which is important for the development of the package but also lets me show a concrete python vs. julia example of how julia code should be written.</p><h3 id="wrong-increment-loading-behaviour-1"><a class="docs-heading-anchor" href="#wrong-increment-loading-behaviour-1">wrong increment loading behaviour</a><a class="docs-heading-anchor-permalink" href="#wrong-increment-loading-behaviour-1" title="Permalink"></a></h3><p>My automated parity tests between julia and python showed python returns data for the <code>u10</code> variable in <code>regular_gg_wrong_increment.grib</code>, whereas Julia throws an error <code>DimensionMismatch(&quot;new dimensions (192, 64) must be consistent with array size 18432&quot;)</code>.</p><p>This happens because the <code>u10</code> variable contains an array of 18 432 values, but it gives dimensions of <code>(192, 64)</code>, which is only 12 288 values, so there are 6 144 more values in than would fit in the array.</p><p>In python, the assignment to the array is done with:</p><pre><code class="language-none">array_field.__getitem__(tuple(array_field_indexes)).flat[:] = values</code></pre><p>Which means that the last values are discarded.</p><p>I can easily implement the same behaviour in Julia, but is this really intended? Those values aren&#39;t missing, they contain actual data which is just thrown away, in my mind this should throw an error by default, but there could be a <code>discard</code> or <code>force_fit</code> flag which allows data to be thrown away.</p><p>The flag could have values of <code>false</code> (default), <code>end</code> (discard data at the end of the array, current behaviour in python) or <code>start</code> (discard data at the start instead).</p><h3 id="segfaults-in-GRIB.jl-1"><a class="docs-heading-anchor" href="#segfaults-in-GRIB.jl-1">segfaults in GRIB.jl</a><a class="docs-heading-anchor-permalink" href="#segfaults-in-GRIB.jl-1" title="Permalink"></a></h3><p>This is completely beyond my skills, I use <code>GRIB.jl</code> to open and read the GRIB files. GRIB.jl provides an interface to eccodes. For some reason I don&#39;t understand, GRIB.jl throws a segfault error when trying to read the sample file <code>reduced_gg.grib</code>.</p><p>Julia calls to c are native, so (I assume) debugging this should be relatively straightforward for somebody who knows the interface to eccodes well, but that&#39;s not me :P could I get some help with tracking down this issue?</p><h3 id="tiny-questions-1"><a class="docs-heading-anchor" href="#tiny-questions-1">tiny questions</a><a class="docs-heading-anchor-permalink" href="#tiny-questions-1" title="Permalink"></a></h3><ul><li>How can I pull out the version of eccodes? It&#39;s stored in the <code>history</code> but I don&#39;t know hot to get it.</li></ul><h1 id="Meeting-Notes-1"><a class="docs-heading-anchor" href="#Meeting-Notes-1">Meeting Notes</a><a class="docs-heading-anchor-permalink" href="#Meeting-Notes-1" title="Permalink"></a></h1><ul><li><p>make grib.jl issue about segfaults and @ steffen</p></li><li><p>wrong increment loading behaviour</p><ul><li>calculate increment and dimensions from the first bits of information</li><li>grib devided into sections, section describes grid geometry information</li><li>other section contains the data</li><li>array of values can be out of sync with the grid geometry</li></ul></li><li><p>logging only for debugging</p><ul><li>warn, error, critical, level logging in julia</li></ul></li><li><p>offsets</p><ul><li>each message is self contained</li><li>message number (count key) starts from 1</li><li>offset is a long integer which is the BYTE OFFSET OF THE MESSAGE IN THE FILE</li><li>seeking to the byte offset puts you at the beginning of the message</li></ul></li><li><p>use readme file as tests for filter by keys</p></li><li><p>history shouldn&#39;t matter much, just leave it as a list of processing steps</p></li><li><p>OnDiskArray leave as float32</p></li><li><p>cfmessage conversion methods</p><ul><li>these methods to have some tests:</li><li>to<em>grib</em>date<em>time, from</em>grib<em>step, to</em>grib_step</li></ul></li><li><p>look for the eccodes c-engine on github to see the version</p><ul><li>eccodes-python python bindings have the way to get the versions</li><li>request GRIB.jl to add a versions method in</li></ul></li><li><p>ask GRIB.jl author about adding in tests</p></li></ul></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 1 November 2020 13:27">Sunday 1 November 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
